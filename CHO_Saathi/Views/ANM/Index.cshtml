@model IEnumerable<CHO_Saathi.ViewModelEntity.VMANMs>
@using Microsoft.AspNetCore.Http;
@{
    if (@Context.Session.GetString("SirjanID") == "1")
    {
        Layout = "~/Views/Shared/_Layout.cshtml";
    }
    else
    {
        Layout = "~/Views/Shared/_Layout.cshtml";
    }


    var edit = TempData["EditRight"] == null ? false : (bool)TempData["EditRight"];
    TempData.Keep("EditRight");
    var delete = TempData["DeleteRight"] == null ? 0 : (int)TempData["DeleteRight"];
    TempData.Keep("DeleteRight");
    var add = TempData["AddRight"] == null ? false : (bool)TempData["AddRight"];
    TempData.Keep("AddRight");
}
<!-- jstree -->
@*<script src="~/jstree/jstree.min.js"></script>
    <link href="~/jstree/jstree.min.css" rel="stylesheet" />
    <link href="~/jstree/style.min.css" rel="stylesheet" />*@
@*<script type="text/javascript">
        $(function () {
            $('#ANMDetails').DataTable({
                dom: 'lBfrtip',
                buttons: [
                    'excelHtml5'
                ],
                'paging': true,
                'lengthChange': false,
                "scrollX": true,
                'searching': true,
                'ordering': true,
                'info': true,
                'autoWidth': false

            })
        })
    </script>*@
<style>
    .card {
        position: relative;
        display: -ms-flexbox;
        display: flex;
        -ms-flex-direction: column;
        flex-direction: column;
        min-width: 0;
        word-wrap: break-word;
        background-color: #fff;
        background-clip: border-box;
        border: 0px solid #72def6;
        border-radius: .25rem;
    }

    .bgButton {
        background: #bfd600 !important;
        border-color: #bfd600 !important;
    }

        .bgButton:hover {
            background: #b2c607 !important;
            border-color: #b2c607 !important;
        }


    .bgbagheader {
        background: #b9f2ff; /* Old browsers */
    }

    .dataTables_length {
        margin-left: 10px;
    }

    .btn-orang {
        color: #fff;
        background-color: #f39c12;
        border-color: #f39c12;
    }

        .btn-orang:hover {
            color: #fff;
            background-color: #fe8936;
            border-color: #fe8936;
        }

    button.dt-button, div.dt-button, a.dt-button {
        position: relative;
        display: inline-block;
        box-sizing: border-box;
        margin-right: 0.333em;
        padding: 0.5em 1em;
        border: 1px solid #999;
        border-radius: 2px;
        cursor: pointer;
        font-size: 0.88em;
        color: black;
        white-space: nowrap;
        overflow: hidden;
        background-color: #e9e9e9;
        background-image: -webkit-linear-gradient(top, #fff 0%, #e9e9e9 100%);
        background-image: -moz-linear-gradient(top, #fff 0%, #e9e9e9 100%);
        background-image: -ms-linear-gradient(top, #fff 0%, #e9e9e9 100%);
        background-image: -o-linear-gradient(top, #fff 0%, #e9e9e9 100%);
        background-image: linear-gradient(to bottom, #fff 0%, #e9e9e9 100%);
        filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0,StartColorStr='white', EndColorStr='#e9e9e9');
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        text-decoration: none;
        outline: none;
    }

    div.dt-buttons {
        position: relative;
        float: left;
    }

    #SearchInput {
        background-image: url('images/icons8-search-48.png');
        background-size: 26px 26px;
        background-repeat: no-repeat;
        background-position: 10px center;
        padding-left: 36px;
        /* background-position: 10px 12px;
                    background-repeat: no-repeat;*/
        width: 100%;
        font-size: 16px;
        padding: 12px 20px 12px 40px;
        border: 1px solid #ddd;
        margin-bottom: 12px;
    }

    input[type="radio"] {
        display: none;
    }

        input[type="radio"] + label {
            font-weight: bold;
            cursor: pointer;
            margin-right: 20px;
            padding-left: 25px;
            position: relative;
        }

            input[type="radio"] + label:before {
                content: '';
                position: absolute;
                left: 0;
                top: 1px;
                width: 18px;
                height: 18px;
                border: 2px solid #007bff;
                border-radius: 50%;
                background-color: white;
                transition: all 0.3s ease;
            }

        input[type="radio"]:checked + label:before {
            background-color: #007bff;
            border-color: #007bff;
        }

    .rowSearch {
        margin-bottom: 20px;
    }

        .rowSearch b {
            margin-right: 10px;
        }
</style>
<section id="AboutSection">

    <div class="container-fluid">
        <div class="row">
            <!-- Left Section -->
            <div class="col-xl-2 col-lg-2">
                <h4 class="Headingcolorbg">Select Hierarchy</h4>
                <hr style="color:#fff;" />

                <div class="form-group">
                    <label class="control-label">State</label>
                    <select type="text" required id="StateID" class="form-control" asp-items="@ViewBag.StateID">
                        <option value="0">All</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="control-label">District</label>
                    <select type="text" required class="form-control" id="DistrictID" name="DistrictID" asp-items="ViewBag.DistrictID">
                        <option value="0">All</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="control-label">Block</label>
                    <select id="BlockID" name="BlockID" class="form-control" asp-items="ViewBag.BlockID" required>
                        <option value="0">All</option>
                    </select>
                </div>
                @* <div class="form-group">
                        <label class="control-label">Facility Type</label>
                        <select class="form-control" id="FaclityTypeID" name="FaclityTypeID" asp-items="ViewBag.FaclityTypeID">
                            <option value="0">All</option>
                        </select>
                    </div>*@
                <div class="form-group">
                    <label class="control-label">Facility</label>
                    <select class="form-control" id="FacilityID" name="FacilityID" asp-items="ViewBag.FacilityID">
                        <option value="0">All</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="control-label">Sub Facility</label>
                    <select class="form-control" id="SubFacilityID" name="SubFacilityID" asp-items="ViewBag.SubFacilityID">
                        <option value="0">All</option>
                    </select>
                </div>
                <div class="form-group text-right">
                    <button type="button" class="btn btn-primary savebutton" onclick="FillProviderList()">
                        <i class="fa fa-search"></i>&nbsp;Search
                    </button>
                </div>
            </div>

            <!-- Right Section -->
            <div class="col-xl-10 col-lg-10">
                <div class="row">
                    <div class="col-xl-2 col-lg-2">
                        <h4 class="Headingcolorbg">ANM Master</h4>
                    </div>
                    <div class="col-xl-8 col-lg-8">
                        <div class="rowSearch">
                            <b>Search By</b>
                            <input type="radio" value="providername" name="searchBy" id="providernameRadio" checked onchange="applyFilter()" />
                            <label for="providernameRadio">Provider Name</label>&nbsp;
                            <input type="radio" value="username" name="searchBy" id="usernameRadio" onchange="applyFilter()" />
                            <label for="usernameRadio">UserName</label>&nbsp;
                            <input type="text" id="SearchInput" placeholder="Search for names.." title="Type in a name">
                        </div>
                    </div>
                    <div class="col-xl-2 col-lg-2">
                        <div class="pull-right">
                            <a asp-action="Create" class="btn btn-primary backtodetailbutton">Add New ANM</a>
                            @*@if (add)
                                {

                                }*@
                        </div>
                    </div>
                </div>
                <div id="divEvidencelist">
                    @{
                        Html.RenderPartial("_ANMPartial.cshtml");
                    }
                </div>
            </div>
        </div>
    </div>

    <input type="hidden" id="saveSizePage" />
</section>
<script type="text/javascript">

    function getServerdt(pageNumber) {
        var selectedValue = document.querySelector('input[name="searchBy"]:checked').value;
        var txtSearch = $("#SearchInput").val();
        $('#saveSizePage').val($('#pageSize').val());
        var p = { "pageIndex": pageNumber, "pageSize": $('#pageSize').val(), "State": $('#StateID').val(), "District": $('#DistrictID').val(), "Block": $('#BlockID').val(),"Facility": $('#FacilityID').val(), "SubFacility": $('#SubFacilityID').val(), "selectedValue": selectedValue, "txtSearch": txtSearch };
        $.ajax({
            url: '@Url.Content("~/")' + "ANM/getServerdt", //Your path should be here
            type: "POST",
            data: p, success: function (result) {
                if (result == "0") {
                    $('#divEvidencelist').html('');
                } else {
                    $('#divEvidencelist').html(result);
                    $('#pageSize').val($('#saveSizePage').val());
                }
            }
        });
    }
    function applyFilter() {
        getServerdt(1);
    }
    $(document).ready(function () {
        var delayTimer;
        $("#SearchInput").keyup(function () {
            clearTimeout(delayTimer);
            delayTimer = setTimeout(function () {
                getServerdt(1);
            }, 500);
        });
    });
</script>

<input type="hidden" id="strhdvillageid" />

<div id="ModalshowVillageList" class="modal fade" tabindex="-1" role="dialog"
     aria-hidden="true" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 style="font-weight:600">ANM</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body p-4">

                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="control-label">State</label><span class="mandatory"> *</span>
                            <select id="TStateID" class="form-control" asp-items="ViewBag.StateID">
                                <option value="0">Select</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="control-label">District</label><span class="mandatory"> *</span>
                            <select id="TDistrictID" class="form-control">
                                <option value="0">Select</option>
                            </select>

                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="control-label">Block</label><span class="mandatory"> *</span>
                            <select id="TBlockID" class="form-control">
                                <option value="0">Select</option>
                            </select>
                        </div>
                    </div>

                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="control-label">Facility Type</label><span class="mandatory"> *</span>
                            <select id="TFacilityTypeId" class="form-control" asp-items="ViewBag.FaclityTypeID">
                                <option value="0">Select</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="control-label">Facility</label><span class="mandatory"> *</span>
                            <select id="TFacilityID" class="form-control">
                                <option value="0">Select</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="control-label">Sub Facility</label>
                            <select id="TSubFacilityID" onchange="getselectedlist('TR');" class="form-control">
                                <option value="0">Select</option>
                            </select>
                        </div>
                    </div>

                </div>

                <div id="DVLINKLIST">

                </div>

            </div>
            <div class="modal-footer">
                <div class="pull-right">

                    <input onclick="LinkGroup('TR');" class="btn btn-primary" value="Tranfer" />

                </div>
            </div>
        </div>

        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<script type="text/javascript">


    $(document).ready(function ()
    {

    $('#StateID').change(function () {
                var url = '@Url.Content("~/")' + "ANM/GetDistrict";
                var ddlsource = "#StateID";
                $.getJSON(url, { stateid: $(ddlsource).val() }, function (data) {
                    var districtitems = "<option value='0'>All</option>";
                    $("#DistrictID").empty();
                    $("#BlockID").html("<option value='0'>All</option>")
                    $.each(data, function (i, district) {
                        districtitems += "<option value='" + district.districtID + "'>" + district.district + "</option>";
                    });
                    $('#DistrictID').html(districtitems);
                });
    });

    $('#DistrictID').change(function () {
        var url = '@Url.Content("~/")' + "ANM/GetBlock";
                var ddlsource = "#DistrictID";
                $.getJSON(url, { districtId: $(ddlsource).val() }, function (data) {
                    var blockitems = "<option value='0'>All</option>";
                    $("#BlockID").empty();
                    $.each(data, function (i, block) {
                        blockitems += "<option value='" + block.blockID + "'>" + block.blockName + "</option>";
                    });
                    $('#BlockID').html(blockitems);
                });
     });

    $('#BlockID').change(function () {
        var url = '@Url.Content("~/")' + "ANM/GetFacility";
        var ddlsource = "#BlockID";
        $.getJSON(url, { blockId: $(ddlsource).val() }, function (data) {
                    var Facilityitems = "<option value='0'>All</option>";
                    $("#FacilityID").empty();
                   $("#SubFacilityID").html("<option value='0'>All</option>")
                  $.each(data, function (i, Facility) {
                      Facilityitems += "<option value='" + Facility.facilityID + "'>" + Facility.facilityName + "</option>";
                    });
                  $('#FacilityID').html(Facilityitems);
        });
    });

    $('#FacilityID').change(function () {
        var url = '@Url.Content("~/")' + "ANM/GetSubFacility";
        var ddlsource = "#FacilityID";
        $.getJSON(url, { faclitityId: $(ddlsource).val() }, function (data) {
                    var SubFacilityitems = "<option value='0'>All</option>";
                     $("#SubFacilityID").empty();
                  $.each(data, function (i, SubFacility) {
                      SubFacilityitems += "<option value='" + SubFacility.subFacilityID + "'>" + SubFacility.subFacility + "</option>";
                    });
            $('#SubFacilityID').html(SubFacilityitems);
                });
    });


        $('#TStateID').change(function () {
                var url = '@Url.Content("~/")' + "ANM/GetDistrict";
                var ddlsource = "#TStateID";
                $.getJSON(url, { stateid: $(ddlsource).val() }, function (data) {
                    var districtitems = "<option value='0'>All</option>";
                    $("#TDistrictID").empty();
                    $("#TBlockID").html("<option value='0'>All</option>")
                    $.each(data, function (i, district) {
                        districtitems += "<option value='" + district.districtID + "'>" + district.district + "</option>";
                    });
                    $('#TDistrictID').html(districtitems);
                });
    });

        $('#TDistrictID').change(function () {
        var url = '@Url.Content("~/")' + "ANM/GetBlock";
                var ddlsource = "#TDistrictID";
                $.getJSON(url, { districtId: $(ddlsource).val() }, function (data) {
                    var blockitems = "<option value='0'>All</option>";
                    $("#TBlockID").empty();
                    $.each(data, function (i, block) {
                        blockitems += "<option value='" + block.blockID + "'>" + block.blockName + "</option>";
                    });
                    $('#TBlockID').html(blockitems);
                });
     });

         @*$('#TBlockID').change(function () {
        var url = '@Url.Content("~/")' + "ANM/GetFacility";
        var ddlsource = "#TBlockID";
        $.getJSON(url, { blockId: $(ddlsource).val() }, function (data) {
                    var Facilityitems = "<option value='0'>All</option>";
                    $("#TFacilityID").empty();
                   $("#TSubFacilityID").html("<option value='0'>All</option>")
                  $.each(data, function (i, Facility) {
                      Facilityitems += "<option value='" + Facility.facilityID + "'>" + Facility.facilityName + "</option>";
                    });
                  $('#TFacilityID').html(Facilityitems);
                });
         });*@

        $('#TFacilityTypeId').change(function () {
            var url = '@Url.Content("~/")' + "ANM/GetFacility";
            var ddlsource = "#TBlockID";
            var ddlfacilitytypeid = "#TFacilityTypeId";
            $.getJSON(url, { blockId: $(ddlsource).val(), FacilityTypeId : $(ddlfacilitytypeid).val() }, function (data) {
                    var Facilityitems = "<option value='0'>Select</option>";
                    $("#TFacilityID").empty();
                  $.each(data, function (i, Facility) {
                      Facilityitems += "<option value='" + Facility.facilityID + "'>" + Facility.facilityName + "</option>";
                    });
                  $('#TFacilityID').html(Facilityitems);
                });
        });

        $('#TFacilityID').change(function () {
        var url = '@Url.Content("~/")' + "ANM/GetSubFacility";
        var ddlsource = "#TFacilityID";
        $.getJSON(url, { faclitityId: $(ddlsource).val() }, function (data) {
                    var SubFacilityitems = "<option value='0'>All</option>";
                     $("#TSubFacilityID").empty();
                  $.each(data, function (i, SubFacility) {
                      SubFacilityitems += "<option value='" + SubFacility.subFacilityID + "'>" + SubFacility.subFacility + "</option>";
                    });
            $('#TSubFacilityID').html(SubFacilityitems);
                });
    });

    });

    function FillProviderList(flag) {
        getServerdt(1);
    }

    function fillsubfacility() {
        var p = { "FacilityID": $('#FacilityID').val() };

                $.ajax({
                    url: "@Url.Action("fillsubfacility", "ANM")", //Your path should be here
                    type: "POST",
                    data: p,
                    success: function (result) {

                        var districtitems = "<option value='0'>Select</option>";
                        $("#drpsubfacility").empty();
                        $.each(result, function (i, district) {
                            districtitems += "<option value='" + district.subFacilityID + "'>" + district.subFacility + "</option>";
                        });
                        $('#drpsubfacility').html(districtitems);

                    },
                    error: function (xhr, status, error) {
                        var err = eval("(" + xhr.responseText + ")");
                        alert(err.Message);
                    }
                });


    }

    function LinkGroup() {


        var p = { "ANMID": $('#hdANMID').val(), "facilityid": $('#FacilityID').val() };

          $.ajax({
              url: "@Url.Action("LinkMember", "ANM")", //Your path should be here
            type: "POST",
            data: p,
            success: function (result) {

                $('#ModalshowVillageList').modal('toggle');
                var url = '@Url.Content("~/")' + "ANM/Index";
                         window.location.href = url;
            },
            error: function (xhr, status, error) {
                var err = eval("(" + xhr.responseText + ")");
                alert(err.Message);
            }
            });

    }

    function checkAll(ele) {
        var checkboxes = document.getElementsByTagName('input');
        if (ele.checked) {
            for (var i = 0; i < checkboxes.length; i++) {
                if (checkboxes[i].type == 'checkbox') {
                    checkboxes[i].checked = true;
                }
            }
        } else {
            for (var i = 0; i < checkboxes.length; i++) {
                console.log(i)
                if (checkboxes[i].type == 'checkbox') {
                    checkboxes[i].checked = false;
                }
            }
        }
    }


    function LinkVllGroup(villageid) {

        var p = { "ANMID": $('#hdANMID').val(), "villageid": villageid };

          $.ajax({
              url: "@Url.Action("LinkVillage", "ANM")", //Your path should be here
            type: "POST",
            data: p,
              success: function (result) {

                  if (result == '0') {
                      alert('done');
                  } else {

                  }

                @*$('#ModalshowVillageList').modal('toggle');
                var url = '@Url.Content("~/")' + "ANM/Index";
                         window.location.href = url;*@
            },
            error: function (xhr, status, error) {
                var err = eval("(" + xhr.responseText + ")");
                alert(err.Message);
            }
            });

    }


    function UserList(ANMID)
    {
        var p = { "ANMID": ANMID };

        $.ajax({
              url: "@Url.Action("UserList", "ANM")", //Your path should be here
            type: "POST",
            data: p,
              success: function (result) {

                  if (result == '0')
                  {
                      alert('done');
                  }
                  else
                  {
                      var url = '@Url.Content("~/")' + "User/Registration?id=" + result.userID;
                      window.location = url;
                  }
            },
            error: function (xhr, status, error) {
                var err = eval("(" + xhr.responseText + ")");
                alert(err.Message);
            }
            });

    }


     function getselectedlist(flag) {
         var p = { "ANMID": $('#hdANMID').val(), "Flag": flag, "SubFacilityID": $('#TSubFacilityID').val() };
        $.ajax({
                    url: "@Url.Action("getvillage", "ANM")", //Your path should be here
                    type: "POST",
                    data: p,
                    success: function (result) {


                        /*fillsubfacility(ANMID);*/
                        $('#DVLINKLIST').html(result);



                    },
                    error: function (xhr, status, error) {
                        var err = eval("(" + xhr.responseText + ")");
                        alert(err.Message);
                    }
                });
    }

</script>
