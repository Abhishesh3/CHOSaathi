@model IEnumerable<CHO_Saathi.Models.ChoMapped>


@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script type="text/javascript">
    $(function () {
        $('#CHOMappedDetails').DataTable({
            dom: 'lBfrtip',
            buttons: [],
            'info': false,
            'lengthChange': false,
            'autoWidth': false
        });
    });
</script>


<div class="container-fluid mt-2">
    <div class="row">
        <div class="col-xl-12">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-xl-4">
                            <h4 class="Headingcolorbg">CHO User Mapping Details</h4>
                        </div>
                        <div class="col-xl-4"></div>
                        <div class="col-xl-4">
                            <div class="float-end">
                                <a asp-action="Index" asp-controller="CHO" class="btn btn-primary"><i class="fa-solid fa-angles-left"></i>&nbsp;Back to List</a>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-xl-12">
                            <table id="CHOUserDetails" class="table table-striped table-bordered cell-border">
                                <thead>
                                    <tr>
                                        <th>Username</th>
                                        <th>
                                            Name
                                        </th>
                                        <th>
                                            State
                                        </th>
                                        <th>
                                            District
                                        </th>
                                        <th>
                                            Block
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>

                                            @ViewBag.CHOUsername

                                        </td>
                                        <td>
                                            @ViewBag.CHOName
                                        </td>
                                        <td>
                                            @ViewBag.stateName
                                        </td>
                                        <td>
                                            @ViewBag.DistrictName
                                        </td>
                                        <td>
                                            @ViewBag.BlockName
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-xl-6">
                            <h4 class="Headingcolorbg">Village Mapping Details</h4>
                        </div>
                        <div class="col-xl-6">
                            <div class="float-end">
                                <!-- Button trigger modal -->
                                <a data-bs-toggle="modal" data-bs-target="#staticBackdrop" onclick="CHOaddvillagePopupfield('@ViewBag.SubFacilityID')" class="btn btn-success"><i class="fa-solid fa-plus"></i>&nbsp;Add Location</a>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xl-12">
                            <hr />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xl-12">
                            <table id="CHOMappedDetails" class="table table-striped table-bordered cell-border">
                                <thead>
                                    <tr>
                                        <th>S.No.</th>
                                        <th>
                                            Facility
                                        </th>
                                        <th>
                                            Subfacility
                                        </th>
                                        <th>
                                            Village
                                        </th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{
                                        int a = 1;
                                        @foreach (var item in Model)
                                        {
                                            <tr>
                                                <td>@a</td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Facility.FacilityName)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.SubFacility.SubFacility)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Village.Village)
                                                </td>
                                                <td>
                                                    <a onclick="removeaddedvillage(@item.ChomappingId,this);" class="text-danger edicon" title="Delete" data-toggle="tooltip" data-placement="bottom"><i class="fa-solid fa-trash" aria-hidden="true"></i></a>
                                                </td>
                                            </tr>
                                            a += 1;
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<input type="hidden" id="hdUserID" value="@ViewBag.choid" />
<input type="hidden" id="hdSubFacilityID" value="@ViewBag.SubFacilityID" />



<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">Modal title</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="DVLINKLIST"></div>
            </div>
            <div class="modal-footer">
                <a class="btn btn-danger" title="Close" onclick="setpagereset(@ViewBag.choid)">Close</a>
                @* <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button> *@
            </div>
        </div>
    </div>
</div>

@section Scripts
{
    <script>
        $(document).ready(function () {
            var alertType = '@TempData["AlertType"]';
            var alertMessage = '@TempData["AlertMessage"]';

            if (alertType && alertMessage)
            {
                showAlert(alertType, '', alertMessage,  '');
            }
        });
    </script>
}


<script type="text/javascript">


    function CHOaddvillagePopupfield(SubFacilityId)
    {
        var flag='NEWVL';

         var p = { "choid": $('#hdUserID').val(), "Flag": flag, "SubFacilityID": SubFacilityId };
            $.ajax({
                url: "@Url.Action("getvillage", "CHOMapped")", //Your path should be here
                type: "POST",
                data: p,
                success: function (result)
                {
                   $('#DVLINKLIST').html(result);
                },
                error: function (xhr, status, error) {
                var err = eval("(" + xhr.responseText + ")");
                alert(err.Message);
                }
            });
    }

    function LinkVllGroup(FacilityId,SubFacilityId,villageid,id)
    {
        var p = { "choid": $('#hdUserID').val(),"villageid": villageid,"FacilityId": FacilityId,"SubFacilityId": SubFacilityId };

          $.ajax({
              url: "@Url.Action("LinkVillage", "CHOMapped")", //Your path should be here
                type: "POST",
                data: p,
                  success: function (result)
                  {

                      if (result == '0')
                      {
                          var row = $(id).parents("tr:first");
                          row.remove();

                          //alert('done');
                      }
                      else
                      {

                      }
                },
                error: function (xhr, status, error) {
                    var err = eval("(" + xhr.responseText + ")");
                    alert(err.Message);
                }
          });
    }

      function removeaddedvillage(chomappingId,id)
      {

        var p = { "chomappingId": chomappingId };

          $.ajax({
              url: "@Url.Action("removeaddedvillage", "CHOMapped")", //Your path should be here
                type: "POST",
                data: p,
                  success: function (result) {

                      if (result == '0') 
                      {
                          var row = $(id).parents("tr:first");

                          row.remove();

                      } 
                      else 
                      {
                          alert('Something went wrong');
                      }
                },
                error: function (xhr, status, error) {
                    var err = eval("(" + xhr.responseText + ")");
                    alert(err.Message);
                }
          });

    }



     function setpagereset(choid)
     {
        $('#staticBackdrop').modal('toggle');
        var url = '@Url.Content("~/")' + "CHOMapped/Index/" + choid +"";
        window.location.href = url;
     }

    function ClosePop(choid)
    {

         $('#staticBackdrop').modal('toggle');
           var url = '@Url.Content("~/")' + "CHOMapped/Index/" + choid +"";
            window.location.href = url;
    }
</script>



